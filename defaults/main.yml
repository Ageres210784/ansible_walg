---
walg_version: v1.0
walg_dbs: pg
walg_binary_name: "wal-g-{{ walg_dbs }}-ubuntu-{{ ansible_lsb.release }}-amd64"
walg_url: "https://github.com/wal-g/wal-g/releases/download/{{ walg_version }}/{{ walg_binary_name }}.tar.gz"
walg_binary_path: /usr/local/bin
walg_user: postgres
walg_group: "{{ walg_user }}"
walg_config_path: "/var/lib/postgresql"
walg_backup_path: "/tmp/base/wal-g-test-data"
walg_log_path: "/var/log/postgresql"

walg_config:
  WALG_FILE_PREFIX: "{{ walg_backup_path }}"
  WALG_COMPRESSION_METHOD: "brotli"
  WALG_DELTA_MAX_STEPS: "6"
  PGHOST: "/var/run/postgresql"
  PGDATA: "/var/lib/postgresql/12/main"

postgresql_conf_change: yes
postgresql_conf_dir: "/etc/postgresql/12/main"
postgresql_conf_params:
  - wal_level=replica
  - archive_mode=on
  - archive_command='{{ walg_binary_path }}/wal-g wal-push "%p" >> {{ walg_log_path }}/archive_command.log 2>&1' 
  - restore_command='{{ walg_binary_path }}/wal-g wal-fetch "%f" "%p" >> {{ walg_log_path }}/restore_command.log 2>&1' 
